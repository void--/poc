# Settings in the [build] context are global and are applied to all contexts
# unless otherwise overridden by more specific contexts.
[build]
    # Directory to change to before starting a build.
    # This is where we will look for package.json/.nvmrc/etc.
    base = "gatsby/"

    # Directory that contains the deploy-ready HTML files and assets generated by
    # the build. This is relative to the base directory if one has been set, or the
    # root directory if a base has not been set.
    publish = "public/"

    # Default build command.
    command = "npm run build"

    # Directory with the serverless Lambda functions to deploy to AWS.
    # Netlify forces you to keep this in the gatsby root, so we have a symlink
    # pointing to /netlify/functions
    functions = "netlify-functions"

[context.production.environment]
    CONTEXT = "production"

[context.branch-deploy.environment]
    CONTEXT = "branch-deploy"

[context.dev.environment] # 'staging' is a branch name
    CONTEXT = "other"
    CONTENTFUL_ENV = "theo"

[[plugins]]
package = "netlify-plugin-gatsby-cache"

# Redirects and headers are GLOBAL for all builds â€“ they do not get scoped to
# contexts no matter where you define them in the file.
# For context-specific rules, use _headers or _redirects files, which are
# PER-DEPLOY.

# A redirect rule with all the supported properties
[[redirects]]

    # By default, redirects won't be applied if there's a file with the same
    # path as the one defined in the `from` property. Setting `force` to `true`
    # will make the redirect rule take precedence over any existing files.
    force = true

# You can also define custom headers within your redirects blocks.
[redirects.headers]
    # @TODO change this to 15 minutes or more.
    Cache-Control = "max-age=60"

[[headers]]
    # Define which paths this specific [[headers]] block will cover.
    for = "/*"

[headers.values]
    # @TODO look into security headers more.
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    Content-Security-Policy = "frame-ancestors https://www.facebook.com"
